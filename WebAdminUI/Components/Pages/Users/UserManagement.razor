@page "/user-management"

@using Application.Contracts.Services
@using AutoMapper
@using Microsoft.AspNetCore.Components.Web
@using Radzen.Blazor
@using WebAdminUI.Models.Users

@inject IUserService UserService; 
@inject IMapper Mapper;

@attribute [StreamRendering]

@rendermode InteractiveServer

<script src="_content/Radzen.Blazor/Radzen.Blazor.js"></script>
<link href="css/main.css" rel="stylesheet">

<PageTitle>User Management</PageTitle>

<h3 style="color: white; font-size: 16px;">Users</h3>

<div class="rz-header-container">

    <RadzenCard Variant="Variant.Outlined" class="rz-header-edit-mode rz-my-4" Style="background: #111212">
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
            <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="add_circle" Text="Add new user" Click="@InsertRow" Disabled="@(editMode == DataGridEditMode.Single && usersToInsert.Count() > 0)" />
            <div>Edit Mode:</div>
            <RadzenSelectBar @bind-Value="@editMode" TextProperty="Text" ValueProperty="Value"
                                Data="@(Enum.GetValues(typeof(DataGridEditMode)).Cast<DataGridEditMode>().Select(t => new { Text = $"{t}", Value = t }))" Size="ButtonSize.Small"
                                Disabled="@(editMode == DataGridEditMode.Multiple && usersToInsert.Count() > 1)" />
        </RadzenStack>
    </RadzenCard>
</div>


<RadzenDataGrid @ref="usersGrid" AllowAlternatingRows="false" AllowFiltering="true" AllowPaging="true" PageSize="10" AllowSorting="true" EditMode="@editMode"
                Data="@users" TItem="UserDataGridAdminModel" RowUpdate="@OnUpdateRow" RowCreate="@OnCreateRow" Sort="@Reset" Page="@Reset" Filter="@Reset" ColumnWidth="150px">
    <Columns>
        <!-- ID Column -->
        <RadzenDataGridColumn Property="Id" Title="User ID" Width="10%" TextAlign="TextAlign.Left" Frozen="true" />

        <!-- Username Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.Username)" Title="Username" Width="15%">
            <EditTemplate Context="user">
                <RadzenTextBox @bind-Value="user.Username" Style="width: 100%; display: block" Name="Username" aria-label="Enter username" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Name Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.Name)" Title="Name" Width="15%">
            <EditTemplate Context="user">
                <RadzenTextBox @bind-Value="user.Name" Style="width: 100%; display: block" Name="Name" aria-label="Enter user name" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Email Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.Email)" Title="Email" Width="20%">
            <EditTemplate Context="user">
                <RadzenTextBox @bind-Value="user.Email" Style="width: 100%; display: block" Name="Email" aria-label="Enter user email" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Email Confirmed Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.EmailConfirmed)" Title="Email Confirmed" Width="10%">
            <EditTemplate Context="user">
                <RadzenCheckBox @bind-Value="user.EmailConfirmed" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Password Hash Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.PasswordHash)" Title="Password Hash" Width="20%">
            <EditTemplate Context="user">
                <RadzenTextBox @bind-Value="user.PasswordHash" Style="width: 100%; display: block" Name="PasswordHash" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Security Stamp Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.SecurityStamp)" Title="Security Stamp" Width="15%">
            <EditTemplate Context="user">
                <RadzenTextBox @bind-Value="user.SecurityStamp" Style="width: 100%; display: block" Name="SecurityStamp" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Phone Number Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.PhoneNumber)" Title="Phone Number" Width="15%">
            <EditTemplate Context="user">
                <RadzenTextBox @bind-Value="user.PhoneNumber" Style="width: 100%; display: block" Name="PhoneNumber" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Phone Number Confirmed Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.PhoneNumberConfirmed)" Title="Phone Confirmed" Width="10%">
            <EditTemplate Context="user">
                <RadzenTextBox @bind-Value="user.PhoneNumberConfirmed" Style="width: 100%; display: block" Name="PhoneNumberConfirmed" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Two-Factor Enabled Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.TwoFactorEnabled)" Title="Two-Factor" Width="10%">
            <EditTemplate Context="user">
                <RadzenCheckBox @bind-Value="user.TwoFactorEnabled" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Lockout Enabled Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.LockoutEnabled)" Title="Lockout Enabled" Width="10%">
            <EditTemplate Context="user">
                <RadzenCheckBox @bind-Value="user.LockoutEnabled" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Lockout End Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.LockoutEnd)" Title="Lockout End" Width="15%">
            <EditTemplate Context="user">
                <RadzenDatePicker @bind-Value="user.LockoutEnd" Style="width: 100%" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Access Failed Count Column -->
        <RadzenDataGridColumn Property="@nameof(UserDataGridAdminModel.AccessFailedCount)" Title="Access Failed Count" Width="10%">
            <EditTemplate Context="user">
                <RadzenNumeric @bind-Value="user.AccessFailedCount" Style="width: 100%" />
            </EditTemplate>
        </RadzenDataGridColumn>

        <!-- Action Buttons -->
        <RadzenDataGridColumn Context="user" Filterable="false" Sortable="false" Width="10%" TextAlign="TextAlign.Right">
            <Template Context="user">
                <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" Click="@(args => EditRow(user))" @onclick:stopPropagation="true">
                </RadzenButton>
                <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="delete" Variant="Variant.Flat" Shade="Shade.Lighter" Size="ButtonSize.Medium" class="rz-my-1 rz-ms-1" Click="@(args => DeleteRow(user))" @onclick:stopPropagation="true">
                </RadzenButton>
            </Template>
            <EditTemplate Context="user">
                <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success" Variant="Variant.Flat" Size="ButtonSize.Medium" Click="@((args) => SaveRow(user))" aria-label="Save">
                </RadzenButton>
                <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" class="rz-my-1 rz-ms-1" Click="@((args) => CancelEdit(user))" aria-label="Cancel">
                </RadzenButton>
                <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="delete" Variant="Variant.Flat" Shade="Shade.Lighter" Size="ButtonSize.Medium" class="rz-my-1 rz-ms-1" Click="@(args => DeleteRow(user))" aria-label="Delete">
                </RadzenButton>
            </EditTemplate>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

